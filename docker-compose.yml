services:
  gotunnel:
    build: .
    restart: unless-stopped
    ports:
      - "8080:8080"  # Admin dashboard & WebSocket
      - "80:80"      # ACME HTTP challenge
      - "443:443"    # HTTPS (Auto TLS)
    volumes:
      - gotunnel_data:/app/data
    environment:
      - GOTUNNEL_DOMAIN=${GOTUNNEL_DOMAIN:-demolocal.online}
      - GOTUNNEL_SECRET=${GOTUNNEL_SECRET:-change-me-to-a-random-secret}
      - GOTUNNEL_ADMIN_PORT=8080
      - GOTUNNEL_PROXY_PORT=80
      - GOTUNNEL_ALLOW_REGISTRATION=${GOTUNNEL_ALLOW_REGISTRATION:-true}
      - GOTUNNEL_DB_TYPE=sqlite
      - GOTUNNEL_SQLITE_DB_PATH=/app/data/gotunnel.db
      - GOTUNNEL_AUTO_TLS=${GOTUNNEL_AUTO_TLS:-false}
      - GOTUNNEL_AUTO_TLS_EMAIL=${GOTUNNEL_AUTO_TLS_EMAIL:-admin@demolocal.online}
      - GOTUNNEL_AUTO_TLS_DIR=/app/data/certs
      - GOTUNNEL_ZEROSSL_API_KEY=${GOTUNNEL_ZEROSSL_API_KEY:-}

  # Optional: Caddy reverse proxy for automatic HTTPS
  # Uncomment the below to add TLS termination
  #
  # caddy:
  #   image: caddy:latest
  #   restart: unless-stopped
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - ./Caddyfile:/etc/caddy/Caddyfile:ro
  #     - caddy_data:/data
  #     - caddy_config:/config
  #   depends_on:
  #     - gotunnel

volumes:
  gotunnel_data:
  # caddy_data:
  # caddy_config:
